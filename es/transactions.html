<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 07-jul-2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Hunter Presnall" />
    <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20130707" />
    <meta http-equiv="Content-Language" content="es" />
    <title>MyBatis - 
    MyBatis-Spring | Transacciones</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis-Spring</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.com/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Publicado el: 07 julio 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Versión: 1.2.1-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Manual de Referencia</li>
                                
      <li>
    
                          <a href="index.html" title="Introducción">
          <i class="none"></i>
        Introducción</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Primeros pasos">
          <i class="none"></i>
        Primeros pasos</a>
            </li>
                  
      <li>
    
                          <a href="factorybean.html" title="SqlSessionFactoryBean">
          <i class="none"></i>
        SqlSessionFactoryBean</a>
            </li>
                                                                                                            
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Transacciones</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="transactions.html#configuration" title="Configuración">
          <i class="none"></i>
        Configuración</a>
            </li>
                      
      <li>
    
                          <a href="transactions.html#container" title="CMT">
          <i class="none"></i>
        CMT</a>
            </li>
                      
      <li>
    
                          <a href="transactions.html#programmatic" title="Ǵestión programática">
          <i class="none"></i>
        Ǵestión programática</a>
            </li>
              </ul>
        </li>
                                                                                      
      <li>
    
                          <a href="sqlsession.html" title="Uso de SqlSession">
          <i class="icon-chevron-right"></i>
        Uso de SqlSession</a>
                  </li>
                                                                                      
      <li>
    
                          <a href="mappers.html" title="Inyección de Mappers">
          <i class="icon-chevron-right"></i>
        Inyección de Mappers</a>
                  </li>
                  
      <li>
    
                          <a href="using-api.html" title="Uso del API de MyBatis">
          <i class="none"></i>
        Uso del API de MyBatis</a>
            </li>
                  
      <li>
    
                          <a href="batch.html" title="Spring Batch">
          <i class="none"></i>
        Spring Batch</a>
            </li>
                  
      <li>
    
                          <a href="sample.html" title="Código de ejemplo">
          <i class="none"></i>
        Código de ejemplo</a>
            </li>
                              <li class="nav-header">Documentación del proyecto</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Información del proyecto">
          <i class="icon-chevron-right"></i>
        Información del proyecto</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Informes del proyecto">
          <i class="icon-chevron-right"></i>
        Informes del proyecto</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Generado por Maven" class="poweredBy">
        <img class="builtBy" alt="Generado por Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Transacciones<a name="Transacciones"></a></h2>
      <p>
        Uno de los principales motivos para usar MyBatis-Spring es que permite que MyBatis participe en transacciones
        de Spring. En lugar de haber creado un TransactionManager especifico para MyBatis, MyBatis-Spring aprovecha
        el existente <tt>DataSourceTransactionManager</tt> de Spring.
      </p>
      <p>
        Una vez que has configurado un TransactionManager in Spring puedes configurar tus transacciones en Spring como siempre.
        Tanto las anotaciones <tt>@Transactional</tt> como las configuraciones de tipo AOP se soportan. 
        Se crear&#xe1; una sola instancia de <tt>SqlSession</tt> para toda la transacci&#xf3;n. 
        Se har&#xe1; commit o rollback de esta sesi&#xf3;n cuando la transacci&#xf3;n finalice.
      </p>
      <p>
        MyBatis-Spring se encargar&#xe1; de gestionar las transacciones de forma transparente una vez se hayan configurado. No es necesario
        incluir c&#xf3;digo adicional en tus clases.
      </p>
  
    <a name="configuration"></a><div class="section" id="configuration"><h3>Configuration Est&#xe1;ndar<a name="Configuration_Estndar"></a></h3>
      <p>
        Para habilitar las transacciones Spring, simplemente crea un <tt>DataSourceTransactionManager</tt> en tu fichero de configuraci&#xf3;n XML:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
&lt;/bean&gt;</pre></div>
      <p>
        El <tt>DataSource</tt> especificado puede ser cualquier <tt>DataSource</tt> JDBC que usar&#xed;as normalmente con Spring.
        Esto incluye connection pools y <tt>DataSource</tt>s obtenidos mediante JNDI.
      </p>
      <p>
        Fijate que el <tt>DataSource</tt> especificado en el transaction manager <b>debe</b> ser el mismo que el que se use para
        crear el <tt>SqlSessionFactoryBean</tt> o la gesti&#xf3;n de transacciones no funcionar&#xe1;.
      </p>
    </div>

    <a name="container"></a><div class="section" id="container"><h3>Container Managed Transactions<a name="Container_Managed_Transactions"></a></h3>
      <p>
        Si est&#xe1;s usando un contenedor JEE y quiere que spring participe en las transacciones gestionadas por contenedor (CMT), entonces debes 
        configurar un <tt>JtaTransactionManager</tt> en Spring o alguna de sus clases espec&#xed;ficas de cada contenedor.
        Lo m&#xe1;s sencillo es utilizar el namespace tx de Spring:
      </p>
      <div class="source"><pre class="prettyprint">&lt;tx:jta-transaction-manager /&gt;</pre></div>
      <p>
        Con esta configuraci&#xf3;n, MyBatis se comportar&#xe1; como cualquier otro recurso configurado con CMT.
        Spring utilizar&#xe1; cualquier transacci&#xf3;n CMT existente y asociar&#xe1; la <tt>SqlSession</tt> a ella. 
        Si no no hay ninguna transacci&#xf3;n previa pero se necesita una en base a la configuraci&#xf3;n de la transacci&#xf3;n, Spring crear&#xe1; 
        una transacci&#xf3;n gestionada por contenedor nueva.
      </p>
      <p>
        Fijate que si quieres usar transacciones CMT pero <b>no</b> quieres utilizar la gesti&#xf3;n de transacciones de Spring 
        <b>no debes</b> configurar ningun transaction manager en Spring y <b>debes</b>
        configurar el <tt>SqlSessionFactoryBean</tt> para que use la clase <tt>ManagedTransactionFactory</tt> de MyBatis de la siguiente forma:
      </p>
      <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
  &lt;property name=&quot;transactionFactory&quot;&gt;
    &lt;bean class=&quot;org.apache.ibatis.transaction.managed.ManagedTransactionFactory&quot; /&gt;
  &lt;/property&gt;  
&lt;/bean&gt;</pre></div>
    </div>
  
    <a name="programmatic"></a><div class="section" id="programmatic"><h3>&#x1f4;esti&#xf3;n program&#xe1;tica de transacci&#xf3;n<a name="aestin_programtica_de_transaccin"></a></h3>
      <p>
        La interfaz <tt>SqlSession</tt> proporciona m&#xe9;todos especificos para gestionar la transacci&#xf3;n.
        Pero al usar MyBatis-Spring en tus beans se inyectar&#xe1; una <tt>SqlSession</tt> o un mapper gestionados por Spring.
        Esto significa que Spring <b>siempre</b> gestionar&#xe1; tus transacciones.
      </p>
      <p>
        No puedes llamar a los m&#xe9;todos <tt>SqlSession.commit()</tt>, <tt>SqlSession.rollback()</tt>
        o <tt>SqlSession.close()</tt> en una <tt>SqlSession</tt> gestionada por Spring.
        Si lo intentas obtendr&#xe1;s una excepci&#xf3;n <tt>UnsupportedOperationException</tt>. 
        Adem&#xe1;s, estos m&#xe9;todos no se exponen en los mapper interfaces.
      </p>
      <p>
        Independientemente de el estado del autocommit de la conexi&#xf3;n JDBC cualquier llamada
        a un metodo SQL de <tt>SqlSession</tt> fuera de una transacci&#xf3;n Spring ser&#xe1; automaticamente commitada.
      </p>
      <p>
        Si quieres controlar las transacciones programaticamente consulta el capitulo 10.6 del manual de referencia de Spring.
        Este c&#xf3;digo muetra como controlar una transacci&#xf3;n manualmente usando el <tt>PlatformTransactionManager</tt> 
        descrito en la sessi&#xf3;n 10.6.2.
      </p>
        <div class="source"><pre class="prettyprint">DefaultTransactionDefinition def = new DefaultTransactionDefinition();
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
try {
  userMapper.insertUser(user);
}
catch (MyException ex) {
  txManager.rollback(status);
  throw ex;
}
txManager.commit(status);</pre></div>
      <p>
        Este c&#xf3;digo usa un mapper pero tambi&#xe9;n funcionar&#xed;a con <tt>SqlSession</tt>.
      </p>
      </div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
