<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2016-03-29 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>mybatis-spring &#x2013; MyBatis-Spring | Utilizar un SqlSession</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
      <meta name="author" content="Hunter Presnall" />
      <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20160329" />
    <meta http-equiv="Content-Language" content="es" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                mybatis-spring
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Publicado el: 2016-03-29</span>
                  &nbsp;| <span id="projectVersion">Versión: 1.2.5</span>
                      </div>
            <div class="xright">        
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Manual de Referencia</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introducción">Introducción</a>
            </li>
                  <li class="none">
                          <a href="getting-started.html" title="Primeros pasos">Primeros pasos</a>
            </li>
                  <li class="none">
                          <a href="factorybean.html" title="SqlSessionFactoryBean">SqlSessionFactoryBean</a>
            </li>
                                                                                                        <li class="collapsed">
                          <a href="transactions.html" title="Transacciones">Transacciones</a>
                  </li>
                                                                                          <li class="expanded">
            <strong>Uso de SqlSession</strong>
                  <ul>
                      <li class="none">
                          <a href="sqlsession.html#SqlSessionTemplate" title="SqlSessionTemplate">SqlSessionTemplate</a>
            </li>
                      <li class="none">
                          <a href="sqlsession.html#SqlSessionDaoSupport" title="SqlSessionDaoSupport">SqlSessionDaoSupport</a>
            </li>
              </ul>
        </li>
                                                                                      <li class="collapsed">
                          <a href="mappers.html" title="Inyección de Mappers">Inyección de Mappers</a>
                  </li>
                  <li class="none">
                          <a href="using-api.html" title="Uso del API de MyBatis">Uso del API de MyBatis</a>
            </li>
                  <li class="none">
                          <a href="batch.html" title="Spring Batch">Spring Batch</a>
            </li>
                  <li class="none">
                          <a href="sample.html" title="Código de ejemplo">Código de ejemplo</a>
            </li>
          </ul>
                       <h5>Documentación del proyecto</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Información del proyecto">Información del proyecto</a>
                  </li>
                                                                                                                                                                                                                                                                                                              <li class="collapsed">
                          <a href="project-reports.html" title="Informes del proyecto">Informes del proyecto</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Generado por Maven" class="poweredBy">
        <img class="poweredBy" alt="Generado por Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Copyright 2010-2012 the original author or authors.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section">
<h2><a name="Uso_de_SqlSession"></a>Uso de SqlSession</h2>
      
<p>
        En MyBatis usas un <tt>SqlSessionFactory</tt> para crear un <tt>SqlSession</tt>. 
        Una vez tienes una sesi&#xf3;n, la usas para ejecutar tus mapped statements, hacer commit o rollback y finalmente
        cuando no la necesitas la cierras. Con MyBatis-Spring no es necesario que utilices la <tt>SqlSessionFactory</tt>
        directamente porque puedes inyectar en tus beans una <tt>SqlSession</tt> thread safe (reentrante) 
        que har&#xe1; de forma autom&#xe1;tica el commit, rollback y se cerrar&#xe1; conforme a la configuraci&#xf3;n de la transacci&#xf3;n en Spring.
      </p>  

    
<div class="section">
<h3><a name="SqlSessionTemplate"></a>SqlSessionTemplate</h3>
      
<p>
        El <tt>SqlSessionTemplate</tt> is el coraz&#xf3;n de MyBatis-Spring.
        Implementa <tt>SqlSession</tt> y est&#xe1; pensado para que sea directamente reemplazable por cualquier c&#xf3;digo 
        que actualmente use <tt>SqlSession</tt>.
        <tt>SqlSessionTemplate</tt> es thread safe y se puede compartir por m&#xe1;s de un DAO.
      </p>

      
<p>
        Cuando se invoca a cualquier m&#xe9;todo SQL, incluyendo cualquier m&#xe9;todo de un mapper devuelto por 
        <tt>getMapper()</tt>, el <tt>SqlSessionTemplate</tt>
        se asegurar&#xe1; de que la <tt>SqlSession</tt> utilizada es la asociada con la transacci&#xf3;n Spring en curso.
        Adicionalmente, se encarga de gestionar su ciclo de vida, incluyendo su cierre, commit o rollback de la sesi&#xf3;n si fuera necesario.
      </p>

      
<p>
        Se debe usar <b>siempre</b> un <tt>SqlSessionTemplate</tt> en lugar de la implementaci&#xf3;n de sesi&#xf3;n 
        por default MyBatis: <tt>DefaultSqlSession</tt>
        porque el template puede participar en transacciones Spring y es thread safe con lo que puede ser inyectado
        en m&#xfa;ltiples mappers (proxies). Cambiar de uno a otro puede crear problemas de integridad de datos. 
      </p>

      
<p>
        El <tt>SqlSessionTemplate</tt> puede construirse usando un <tt>SqlSessionFactory</tt> como argumento de su constructor.
      </p>
        
<div class="source">
<pre>&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>        
     
      
<p>
        Este bean puede ser inyectado directamente en tus DAOs. Necesitar&#xe1;s una propiedad
        <tt>SqlSession</tt> en tu bean como se muestra a continuaci&#xf3;n:
      </p>
        
<div class="source">
<pre>public class UserDaoImpl implements UserDao {

  private SqlSession sqlSession;

  public void setSqlSession(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }

  public User getUser(String userId) {
    return (User) sqlSession.selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      
<p>
        E inyectar el <tt>SqlSessionTemplate</tt> de la siguiente forma:
      </p>      
      
<div class="source">
<pre>&lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.sample.dao.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSession&quot; ref=&quot;sqlSession&quot; /&gt;
&lt;/bean&gt;</pre></div>
      
      
<p>
        El <tt>SqlSessionTemplate</tt> tiene tambi&#xe9;n un constructor que recibe como par&#xe1;metro
        un <tt>ExecutorType</tt>. Esto permite construir, por ejemplo,
        una <tt>SqlSession</tt> batch utilizando la siguiente configurac&#xed;on de Spring:
      </p>
        
<div class="source">
<pre>&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
  &lt;constructor-arg index=&quot;1&quot; value=&quot;BATCH&quot; /&gt;
&lt;/bean&gt;</pre></div>
      
<p>
        Ahora todos tus statements se ejecutar&#xe1;n en batch de forma que puedes programar lo siguiente:
      </p>
        
<div class="source">
<pre>public void insertUsers(User[] users) {
   for (User user : users) {
     sqlSession.insert(&quot;org.mybatis.spring.sample.mapper.UserMapper.insertUser&quot;, user);
   }
 }</pre></div> 
  
      
<p>
        Fijate que esta configuraci&#xf3;n si el m&#xe9;todo de ejecuci&#xf3;n deseado es distinto del establecido por defecto
        en el <tt>SqlSessionFactory</tt>.
      </p>

      
<p>
        La contrapartida de esto es que <b>no es posible</b> cambiar el m&#xe9;odo de ejecuci&#xf3;n dentro de una transacci&#xf3;n.
        Por tanto asegurate que o bien todas las llamadas a un <tt>SqlSessionTemplate</tt>s con distinto m&#xe9;todo de ejecuci&#xf3;n
        se ejecutan en una transacci&#xf3;n diferente (p.ej: with PROPAGATION_REQUIRES_NEW) o completamente fuera de la transacci&#xf3;n.
      </p>
    </div>

    
<div class="section">
<h3><a name="SqlSessionDaoSupport"></a>SqlSessionDaoSupport</h3>
      
<p>
        <tt>SqlSessionDaoSupport</tt> es una clase de soporte abstracta que proporciona un <tt>SqlSession</tt>. 
        Llamando a <tt>getSqlSession()</tt> obtiene un <tt>SqlSessionTemplate</tt>
        que puedes utilizar para ejecutar m&#xe9;todos SQL, como sigue:
      </p>
        
<div class="source">
<pre>public class UserDaoImpl extends SqlSessionDaoSupport implements UserDao {
  public User getUser(String userId) {
    return (User) getSqlSession().selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      
<p>
        Normalmente es preferible usar un <tt>MapperFactoryBean</tt> a esta clase dao que no requeire c&#xf3;digo extra.
        Pero esta clase es de utilidad cuando es necesario hacer alg&#xfa;n otro tipo de trabajo no-MyBatis en el DAO y se necesitan
        clases concretas.
      </p>

      
<p>
        <tt>SqlSessionDaoSupport</tt> que se informe la propiedad 
        <tt>sqlSessionFactory</tt> o la <tt>sqlSessionTemplate</tt>.
        Si se informan ambas propiedades, la <tt>sqlSessionFactory</tt> se ignora.
      </p>

      
<p>
        Asumiendo una clase <tt>UserDaoImpl</tt> que extiende 
        <tt>SqlSessionDaoSupport</tt>, se puede configurar Spring de la siguiente forma:
      </p>
        
<div class="source">
<pre>&lt;bean id=&quot;userMapper&quot; class=&quot;org.mybatis.spring.sample.mapper.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>
      </div>
    </div>
  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2010&#x2013;2016
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
