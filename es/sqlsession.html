<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 03-abr-2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130403" />
    <meta http-equiv="Content-Language" content="es" />
    <title>MyBatis - 
    MyBatis-Spring | Utilizar un SqlSession</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis-Spring</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.com/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Publicado el: 03 abril 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Versión: 1.2.1-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Manual de Referencia</li>
                                
      <li>
    
                          <a href="index.html" title="Introducción">
          <i class="none"></i>
        Introducción</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Primeros pasos">
          <i class="none"></i>
        Primeros pasos</a>
            </li>
                  
      <li>
    
                          <a href="factorybean.html" title="SqlSessionFactoryBean">
          <i class="none"></i>
        SqlSessionFactoryBean</a>
            </li>
                                                                                                        
      <li>
    
                          <a href="transactions.html" title="Transacciones">
          <i class="icon-chevron-right"></i>
        Transacciones</a>
                  </li>
                                                                                          
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Uso de SqlSession</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="sqlsession.html#SqlSessionTemplate" title="SqlSessionTemplate">
          <i class="none"></i>
        SqlSessionTemplate</a>
            </li>
                      
      <li>
    
                          <a href="sqlsession.html#SqlSessionDaoSupport" title="SqlSessionDaoSupport">
          <i class="none"></i>
        SqlSessionDaoSupport</a>
            </li>
              </ul>
        </li>
                                                                                      
      <li>
    
                          <a href="mappers.html" title="Inyección de Mappers">
          <i class="icon-chevron-right"></i>
        Inyección de Mappers</a>
                  </li>
                  
      <li>
    
                          <a href="using-api.html" title="Uso del API de MyBatis">
          <i class="none"></i>
        Uso del API de MyBatis</a>
            </li>
                  
      <li>
    
                          <a href="batch.html" title="Spring Batch">
          <i class="none"></i>
        Spring Batch</a>
            </li>
                  
      <li>
    
                          <a href="sample.html" title="Código de ejemplo">
          <i class="none"></i>
        Código de ejemplo</a>
            </li>
                              <li class="nav-header">Documentación del proyecto</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Información del proyecto">
          <i class="icon-chevron-right"></i>
        Información del proyecto</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Informes del proyecto">
          <i class="icon-chevron-right"></i>
        Informes del proyecto</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Generado por Maven" class="poweredBy">
        <img class="builtBy" alt="Generado por Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Uso de SqlSession<a name="Uso_de_SqlSession"></a></h2>
      <p>
        En MyBatis usas un <tt>SqlSessionFactory</tt> para crear un <tt>SqlSession</tt>. 
        Una vez tienes una sesi&#xf3;n, la usas para ejecutar tus mapped statements, hacer commit o rollback y finalmente
        cuando no la necesitas la cierras. Con MyBatis-Spring no es necesario que utilices la <tt>SqlSessionFactory</tt>
        directamente porque puedes inyectar en tus beans una <tt>SqlSession</tt> thread safe (reentrante) 
        que har&#xe1; de forma autom&#xe1;tica el commit, rollback y se cerrar&#xe1; conforme a la configuraci&#xf3;n de la transacci&#xf3;n en Spring.
      </p>  

    <div class="section"><h3>SqlSessionTemplate<a name="SqlSessionTemplate"></a></h3>
      <p>
        El <tt>SqlSessionTemplate</tt> is el coraz&#xf3;n de MyBatis-Spring.
        Implementa <tt>SqlSession</tt> y est&#xe1; pensado para que sea directamente reemplazable por cualquier c&#xf3;digo 
        que actualmente use <tt>SqlSession</tt>.
        <tt>SqlSessionTemplate</tt> es thread safe y se puede compartir por m&#xe1;s de un DAO.
      </p>

      <p>
        Cuando se invoca a cualquier m&#xe9;todo SQL, incluyendo cualquier m&#xe9;todo de un mapper devuelto por 
        <tt>getMapper()</tt>, el <tt>SqlSessionTemplate</tt>
        se asegurar&#xe1; de que la <tt>SqlSession</tt> utilizada es la asociada con la transacci&#xf3;n Spring en curso.
        Adicionalmente, se encarga de gestionar su ciclo de vida, incluyendo su cierre, commit o rollback de la sesi&#xf3;n si fuera necesario.
      </p>

      <p>
        Se debe usar <b>siempre</b> un <tt>SqlSessionTemplate</tt> en lugar de la implementaci&#xf3;n de sesi&#xf3;n 
        por default MyBatis: <tt>DefaultSqlSession</tt>
        porque el template puede participar en transacciones Spring y es thread safe con lo que puede ser inyectado
        en m&#xfa;ltiples mappers (proxies). Cambiar de uno a otro puede crear problemas de integridad de datos. 
      </p>

      <p>
        El <tt>SqlSessionTemplate</tt> puede construirse usando un <tt>SqlSessionFactory</tt> como argumento de su constructor.
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>        
     
      <p>
        Este bean puede ser inyectado directamente en tus DAOs. Necesitar&#xe1;s una propiedad
        <tt>SqlSession</tt> en tu bean como se muestra a continuaci&#xf3;n:
      </p>
        <div class="source"><pre class="prettyprint">public class UserDaoImpl implements UserDao {

  private SqlSession sqlSession;

  public void setSqlSession(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }

  public User getUser(String userId) {
    return (User) sqlSession.selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      <p>
        E inyectar el <tt>SqlSessionTemplate</tt> de la siguiente forma:
      </p>      
      <div class="source"><pre class="prettyprint">&lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.sample.dao.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSession&quot; ref=&quot;sqlSession&quot; /&gt;
&lt;/bean&gt;</pre></div>
      
      <p>
        El <tt>SqlSessionTemplate</tt> tiene tambi&#xe9;n un constructor que recibe como par&#xe1;metro
        un <tt>ExecutorType</tt>. Esto permite construir, por ejemplo,
        una <tt>SqlSession</tt> batch utilizando la siguiente configurac&#xed;on de Spring:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
  &lt;constructor-arg index=&quot;1&quot; value=&quot;BATCH&quot; /&gt;
&lt;/bean&gt;</pre></div>
      <p>
        Ahora todos tus statements se ejecutar&#xe1;n en batch de forma que puedes programar lo siguiente:
      </p>
        <div class="source"><pre class="prettyprint">public void insertUsers(User[] users) {
   for (User user : users) {
     sqlSession.insert(&quot;org.mybatis.spring.sample.mapper.UserMapper.insertUser&quot;, user);
   }
 }</pre></div> 
  
      <p>
        Fijate que esta configuraci&#xf3;n si el m&#xe9;todo de ejecuci&#xf3;n deseado es distinto del establecido por defecto
        en el <tt>SqlSessionFactory</tt>.
      </p>

      <p>
        La contrapartida de esto es que <b>no es posible</b> cambiar el m&#xe9;odo de ejecuci&#xf3;n dentro de una transacci&#xf3;n.
        Por tanto asegurate que o bien todas las llamadas a un <tt>SqlSessionTemplate</tt>s con distinto m&#xe9;todo de ejecuci&#xf3;n
        se ejecutan en una transacci&#xf3;n diferente (p.ej: with PROPAGATION_REQUIRES_NEW) o completamente fuera de la transacci&#xf3;n.
      </p>
    </div>

    <div class="section"><h3>SqlSessionDaoSupport<a name="SqlSessionDaoSupport"></a></h3>
      <p>
        <tt>SqlSessionDaoSupport</tt> es una clase de soporte abstracta que proporciona un <tt>SqlSession</tt>. 
        Llamando a <tt>getSqlSession()</tt> obtiene un <tt>SqlSessionTemplate</tt>
        que puedes utilizar para ejecutar m&#xe9;todos SQL, como sigue:
      </p>
        <div class="source"><pre class="prettyprint">public class UserDaoImpl extends SqlSessionDaoSupport implements UserDao {
  public User getUser(String userId) {
    return (User) getSqlSession().selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      <p>
        Normalmente es preferible usar un <tt>MapperFactoryBean</tt> a esta clase dao que no requeire c&#xf3;digo extra.
        Pero esta clase es de utilidad cuando es necesario hacer alg&#xfa;n otro tipo de trabajo no-MyBatis en el DAO y se necesitan
        clases concretas.
      </p>

      <p>
        <tt>SqlSessionDaoSupport</tt> que se informe la propiedad 
        <tt>sqlSessionFactory</tt> o la <tt>sqlSessionTemplate</tt>.
        Si se informan ambas propiedades, la <tt>sqlSessionFactory</tt> se ignora.
      </p>

      <p>
        Asumiendo una clase <tt>UserDaoImpl</tt> que extiende 
        <tt>SqlSessionDaoSupport</tt>, se puede configurar Spring de la siguiente forma:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;userMapper&quot; class=&quot;org.mybatis.spring.sample.mapper.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>
      </div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
