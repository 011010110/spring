<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Apr 2, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130402" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis - 
    MyBatis-Spring | Transactions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis-Spring</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.com/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 02 April 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.2.1-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Reference Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li>
    
                          <a href="factorybean.html" title="SqlSessionFactoryBean">
          <i class="none"></i>
        SqlSessionFactoryBean</a>
            </li>
                                                                                                            
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Transactions</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="transactions.html#configuration" title="Standard Configuration">
          <i class="none"></i>
        Standard Configuration</a>
            </li>
                      
      <li>
    
                          <a href="transactions.html#container" title="Container Managed Transactions">
          <i class="none"></i>
        Container Managed Transactions</a>
            </li>
                      
      <li>
    
                          <a href="transactions.html#programmatic" title="Programmatic">
          <i class="none"></i>
        Programmatic</a>
            </li>
              </ul>
        </li>
                                                                                      
      <li>
    
                          <a href="sqlsession.html" title="Using an SqlSession">
          <i class="icon-chevron-right"></i>
        Using an SqlSession</a>
                  </li>
                                                                                      
      <li>
    
                          <a href="mappers.html" title="Injecting Mappers">
          <i class="icon-chevron-right"></i>
        Injecting Mappers</a>
                  </li>
                  
      <li>
    
                          <a href="using-api.html" title="Using the MyBatis API">
          <i class="none"></i>
        Using the MyBatis API</a>
            </li>
                  
      <li>
    
                          <a href="batch.html" title="Spring Batch">
          <i class="none"></i>
        Spring Batch</a>
            </li>
                  
      <li>
    
                          <a href="sample.html" title="Sample Code">
          <i class="none"></i>
        Sample Code</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Transactions<a name="Transactions"></a></h2>
      <p>
        One of the primary reasons for using MyBatis-Spring is that it allows
        MyBatis to participate in Spring transactions. Rather than create a new
        transaction manager specific to MyBatis, MyBatis-Spring leverages the
        existing <tt>DataSourceTransactionManager</tt> in Spring.
      </p>
      <p>
        Once a Spring transaction manager is configured, you can configure
        transactions in Spring as you normally would. Both
        <tt>@Transactional</tt> annotations and AOP style
        configurations are supported. A single <tt>SqlSession</tt>
        object will be created and used for the duration of the transaction. This
        session will be committed or rolled back as appropriate when then
        transaction completes.
      </p>
      <p>
        MyBatis-Spring will transparently manage transactions once they are set up.
        There is no need for additional code in your DAO classes.
      </p>
  
    <a name="configuration"></a><div class="section" id="configuration"><h3>Standard Configuration<a name="Standard_Configuration"></a></h3>
      <p>
        To enable Spring transaction processing, simply create a
        <tt>DataSourceTransactionManager</tt> in your Spring XML
        configuration file:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
&lt;/bean&gt;</pre></div>
      <p>
        The <tt>DataSource</tt> specified can be any JDBC
        <tt>DataSource</tt> you would normally
        use with Spring. This includes connection pools as well as <tt>DataSource</tt>s
        obtained through JNDI lookups.
      </p>
      <p>
        Note that the <tt>DataSource</tt> specified for the transaction
        manager <b>must</b> be the same one that is used to create
        the <tt>SqlSessionFactoryBean</tt> or transaction management will
        not work.
      </p>
    </div>

    <a name="container"></a><div class="section" id="container"><h3>Container Managed Transactions<a name="Container_Managed_Transactions"></a></h3>
      <p>
        If you are using a JEE container and would like Spring to participate in
        container managed transactions (CMT), then Spring should be configured
        with a <tt>JtaTransactionManager</tt> or one of its container
        specific subclasses. The easiest way to do this is to use the Spring
        transaction namespace:
      </p>
      <div class="source"><pre class="prettyprint">&lt;tx:jta-transaction-manager /&gt;</pre></div>
      <p>
        In this configuration, MyBatis will behave like any other Spring
        transactional resource configured with CMT. Spring will automatically use
        any existing container transaction and attach an <tt>SqlSession</tt> to it. If no
        transaction is started and one is needed based on the transaction
        configuration, Spring will start a new container managed transaction.
      </p>
      <p>
        Note that if you want to use CMT and do <b>not</b> want to
        use Spring transaction management, you <b>must not</b>
        configure any Spring transaction manager and you <b>must</b>
        also configure the <tt>SqlSessionFactoryBean</tt> to use the base
        MyBatis <tt>ManagedTransactionFactory</tt>:
      </p>
      <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
  &lt;property name=&quot;transactionFactory&quot;&gt;
    &lt;bean class=&quot;org.apache.ibatis.transaction.managed.ManagedTransactionFactory&quot; /&gt;
  &lt;/property&gt;  
&lt;/bean&gt;</pre></div>
    </div>
  
    <a name="programmatic"></a><div class="section" id="programmatic"><h3>Programmatic Transaction Management<a name="Programmatic_Transaction_Management"></a></h3>
      <p>
        MyBatis <tt>SqlSession</tt> provides you with specific methods to handle
        transactions programmatically. But when using MyBatis-Spring your beans will be
        injected with a Spring managed <tt>SqlSession</tt> or a Spring managed mapper.
        That means that Spring will <b>always</b> handle your transactions.
      </p>
      <p>
        You cannot call <tt>SqlSession.commit()</tt>, <tt>SqlSession.rollback()</tt>
        or <tt>SqlSession.close()</tt> over a Spring managed <tt>SqlSession</tt>.
        If you try to do so, a <tt>UnsupportedOperationException</tt> exception
        will be thrown. Note these methods are not exposed in injected mapper classes.
      </p>
      <p>
        Regardless of your JDBC connection's autocommit setting, any execution of a
        <tt>SqlSession</tt> data method or any call to a mapper
        method outside a Spring transaction will be automatically committed.
      </p>
      <p>
        If you want to control your transactions programmatically please refer to chapter 10.6 of
        the Spring reference manual. This code shows how to handle a transaction manually
        using the <tt>PlatformTransactionManager</tt> described in section 10.6.2.
      </p>
        <div class="source"><pre class="prettyprint">DefaultTransactionDefinition def = new DefaultTransactionDefinition();
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
try {
  userMapper.insertUser(user);
}
catch (MyException ex) {
  txManager.rollback(status);
  throw ex;
}
txManager.commit(status);</pre></div>
      <p>
        Notice that this code uses a mapper, but it will also work with a <tt>SqlSession</tt>.
      </p>
      </div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
